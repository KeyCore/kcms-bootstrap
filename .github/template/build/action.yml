name: build
description:  "Build and Create a release"

inputs:
  project-name:
    description: 'Name of the project'
    required: true
  build_version:
    description: Build version
    required: true
  guthub_token:
    description: The github token from secrets.GITHUB_TOKEN
    required: true

runs:
  using: composite
  steps:
    - name: BUILD_VERSION
      run: echo ${{ inputs.build_version }}
      shell: bash

    - id: build
      name: Build
      shell: bash
      run: |
        npm install
        npm run synth

    - name: Create Release
      id: create_release
      uses: actions/create-release@v1
      env:
        GITHUB_TOKEN: ${{ inputs.guthub_token }}
      with:
        tag_name: ${{ inputs.build_version }}
        release_name: v${{ inputs.build_version }}
        draft: false
        prerelease: true

    - name: Upload release assets
      uses: actions/upload-release-asset@v1
      env:
        GITHUB_TOKEN: ${{ inputs.guthub_token }}
      with:
        upload_url: ${{ steps.create_release.outputs.upload_url }}
        asset_path: ./release.zip
        asset_name: .${{ inputs.project-name }}-build.${{ inputs.build_version }}.zip
        asset_content_type: application/zip